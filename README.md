## üõí –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ Order Service

**Order Service** _‚Äî —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FastAPI, PostgreSQL, Redis, RabbitMQ –∏ Celery+Flower._

## –¶–µ–ª—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

_–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –Ω–∞ FastAPI, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, —Ä–∞–±–æ—Ç—É —Å –æ—á–µ—Ä–µ–¥—è–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–æ–Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–¥–∞—á._

_–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ "new_order" –≤ –æ—á–µ—Ä–µ–¥—å.
–ö–æ–Ω—Å—å—é–º–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑ –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ –≤ Celery.
–ï—Å–ª–∏ –∑–∞–∫–∞–∑ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ —Ç–æ –æ–Ω –æ—Ç–¥–∞–µ—Ç –µ–≥–æ –∏–∑ –∫–µ—à–∞ (TTL = 5 –º–∏–Ω—É—Ç).
–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ ‚Äì –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–µ—à._

### –í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

**Rate limiting (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤)** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã API –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –∑–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏.

**CORS (Cross-Origin Resource Sharing)** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü –∫ —Ä–µ—Å—É—Ä—Å–∞–º, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–º –Ω–∞ –¥—Ä—É–≥–æ–º –¥–æ–º–µ–Ω–µ (–∏–ª–∏ –ø–æ—Ä—Ç—É). –û–Ω –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å REST API.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏.

### üì¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
**FastAPI** ‚Äî –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫

**PostgreSQL** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –ë–î

**Redis** ‚Äî –∫—ç—à –¥–ª—è –∑–∞–∫–∞–∑–æ–≤

**RabbitMQ** ‚Äî –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

**Celery** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á

**Docker** + Docker Compose ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

**Alembic** ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Å Docker
1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone https://github.com/makstravel/order_service_testovoe.git && cd order_service_testovoe
```

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env:

```env
DB_HOST=...
DB_PORT=...
DB_NAME=...
DB_USER=...
DB_PASSWORD=...

REDIS_HOST=redis
REDIS_PORT=6379
CACHE_TTL_SECONDS=300

RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest

SECRET_KEY=...
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=15

RATE_LIMIT=100/minute
ALLOWED_ORIGINS_RAW=http://localhost,http://127.0.0.1
```


```bash
!!–í–Ω—É—Ç—Ä–∏ –≤–ª–æ–∂–µ–Ω —Ñ–∞–π–ª entrypoint.sh –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏!
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
```bash
docker-compose up --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
```
üìç http://localhost:8000
```

### üìò Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
```bash
üìÑ http://localhost:8000/docs
```
### üß™ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç**	
```bash
docker-compose up --build
```

**–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç**
```bash
docker-compose down -v
```

**–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é**
```bash
docker-compose exec web alembic upgrade head
```

**–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Redis CLI**
```bash
docker-compose exec redis redis-cli
```

**–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL**
```bash
docker-compose exec db psql -U order_user -d order_db
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
```bash
docker-compose logs -f web
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Celery –≤–æ—Ä–∫–µ—Ä–∞**
```bash
docker-compose logs -f celery_worker
```

### üß† –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
POST /register/

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:**
POST /token/

**–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞:**
POST /orders/

–ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ JWT –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization: Bearer <token>

**–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:**
GET /orders/{order_id}/
–°–Ω–∞—á–∞–ª–∞ –∏–∑ Redis, –∑–∞—Ç–µ–º –∏–∑ –ë–î

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞:**
PATCH /orders/{order_id}/

**–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
GET /orders/user/{user_id}/



